COPY    START   1000            COPY FILE FROM INPUT TO OUTPUT
COPY
START
0
1000 
1000 

FIRST   STL     RETADR          SAVE RETURN ADDRESS
FIRST
STL
14
1000
RETADR

CLOOP   JSUB    RDREC           READ INPUT RECORD
CLOOP
JSUB
48
1003
RDREC

        LDA     LENGTH          TEST FOR EOF (LENGTH = 0)

LDA
0
1006
LENGTH

        COMP    ZERO

COMP
28
1009
ZERO

        JEQ     ENDFIL          EXIT IF EOF FOUND

JEQ
30
100c
ENDFIL

        JSUB    WRREC           WRITE OUTPUT RECORD

JSUB
48
100f
WRREC

        J       CLOOP           LOOP

J
3c
1012
CLOOP

ENDFIL  LDA     EOF             INSERT END OF FILE MARKER
ENDFIL
LDA
0
1015
EOF

        STA     BUFFER

STA
c
1018
BUFFER

        LDA     THREE           SET LENGTH = 3

LDA
0
101b
THREE

        STA     LENGTH

STA
c
101e
LENGTH

        JSUB    WRREC           WRITE EOF

JSUB
48
1021
WRREC

        LDL     RETADR          GET RETURN ADDRESS

LDL
8
1024
RETADR

        RSUB                    RETURN TO CALLER

RSUB
0
1027


EOF     BYTE    C'EOF'
EOF
BYTE
0
102a
C'EOF'

THREE   WORD    3
THREE
WORD
0
102d
3

ZERO    WORD    0
ZERO
WORD
0
1030
0

RETADR  RESW    1
RETADR
RESW
0
1033
1

LENGTH  RESW    1               LENGTH OF RECORD
LENGTH
RESW
0
1036
1

BUFFER  RESB    4096            4096-BYTE BUFFER AREA
BUFFER
RESB
0
1039
4096

.
.       SUBROUTINE TO READ RECORD INTO BUFFER
.
RDREC   LDX     ZERO            CLEAR LOOP COUNTER
RDREC
LDX
4
2039
ZERO

        LDA     ZERO            CLEAR A TO ZERO

LDA
0
203c
ZERO

RLOOP   TD      INPUT           TEST INPUT DEVICE
RLOOP
TD
e0
203f
INPUT

        JEQ     RLOOP           LOOP UNTIL READY

JEQ
30
2042
RLOOP

        RD      INPUT           READ CHARACTER INTO REGISTAR A

RD
d8
2045
INPUT

        COMP    ZERO            TEST FOR END OF RECORD (X'00')

COMP
28
2048
ZERO

        JEQ     EXIT            EXIT LOOP IF EOF

JEQ
30
204b
EXIT

        STCH    BUFFER,X        STORE CHARCTER IN BUFFER

STCH
54
204e
BUFFER,X

        TIX     MAXLEN          LOOP UNLESS MAX LENGTH

TIX
2c
2051
MAXLEN

        JLT     RLOOP             HAS BEEN REACHED

JLT
38
2054
RLOOP

EXIT    STX     LENGTH          SAVE RECORD LENGTH
EXIT
STX
10
2057
LENGTH

        RSUB                    RETURN TO CALLER

RSUB
0
205a


INPUT   BYTE    X'F1'           CODE FOR INPUT DEVICE
INPUT
BYTE
0
205d
X'F1'

MAXLEN  WORD    4096
MAXLEN
WORD
0
205e
4096

.
.       SUBROUTINE TO WRITE RECORD FROM BUFFER
.
WRREC   LDX    ZERO             CLEAR LOOP COUNTER
WRREC
LDX
4
2061
ZERO

WLOOP   TD     OUTPUT           TEST OUTPUT DEVICE
WLOOP
TD
e0
2064
OUTPUT

        JEQ    WLOOP            LOOP UNTIL READY

JEQ
30
2067
WLOOP

        LDCH   BUFFER,X         GET CHARCTER FROM BUFFER

LDCH
50
206a
BUFFER,X

        WD     OUTPUT           WRITE CHARACTER

WD
dc
206d
OUTPUT

        TIX    LENGTH           LOOP UNTIL ALL CHARACTERS

TIX
2c
2070
LENGTH

        JLT    WLOOP              HAVE BEEN WRITTEN

JLT
38
2073
WLOOP

        RSUB                    RETURN TO CALLER

RSUB
0
2076


OUTPUT  BYTE   X'05'            CODE FOR OUTPUT DEVICE
OUTPUT
BYTE
0
2079
X'05'

        END    FIRST
FIRST 1000
CLOOP 1003
ENDFIL 1015
EOF 102a
THREE 102d
ZERO 1030
RETADR 1033
LENGTH 1036
BUFFER 1039
RDREC 2039
RLOOP 203f
EXIT 2057
INPUT 205d
MAXLEN 205e
WRREC 2061
WLOOP 2064
OUTPUT 2079
