COPY    START   1000            COPY FILE FROM INPUT TO OUTPUT

1000 
1000 

FIRST   STL     RETADR          SAVE RETURN ADDRESS
14
1003
RETADR

CLOOP   JSUB    RDREC           READ INPUT RECORD
48
1006
RDREC

        LDA     LENGTH          TEST FOR EOF (LENGTH = 0)
0
1009
LENGTH

        COMP    ZERO
28
100c
ZERO

        JEQ     ENDFIL          EXIT IF EOF FOUND
30
100f
ENDFIL

        JSUB    WRREC           WRITE OUTPUT RECORD
48
1012
WRREC

        J       CLOOP           LOOP
3c
1015
CLOOP

ENDFIL  LDA     EOF             INSERT END OF FILE MARKER
0
1018
EOF

        STA     BUFFER
c
101b
BUFFER

        LDA     THREE           SET LENGTH = 3
0
101e
THREE

        STA     LENGTH
c
1021
LENGTH

        JSUB    WRREC           WRITE EOF
48
1024
WRREC

        LDL     RETADR          GET RETURN ADDRESS
8
1027
RETADR

        RSUB                    RETURN TO CALLER
0
1027


EOF     BYTE    C'EOF'
0
102a
C'EOF'

THREE   WORD    3
0
102d
3

ZERO    WORD    0
0
1030
0

RETADR  RESW    1
0
1033
1

LENGTH  RESW    1               LENGTH OF RECORD
0
1036
1

BUFFER  RESB    4096            4096-BYTE BUFFER AREA
0
2036
4096

.
.       SUBROUTINE TO READ RECORD INTO BUFFER
.
RDREC   LDX     ZERO            CLEAR LOOP COUNTER
4
2039
ZERO

        LDA     ZERO            CLEAR A TO ZERO
0
203c
ZERO

RLOOP   TD      INPUT           TEST INPUT DEVICE
e0
203f
INPUT

        JEQ     RLOOP           LOOP UNTIL READY
30
2042
RLOOP

        RD      INPUT           READ CHARACTER INTO REGISTAR A
d8
2045
INPUT

        COMP    ZERO            TEST FOR END OF RECORD (X'00')
28
2048
ZERO

        JEQ     EXIT            EXIT LOOP IF EOF
30
204b
EXIT

        STCH    BUFFER        STORE CHARCTER IN BUFFER
54
204e
BUFFER

        TIX     MAXLEN          LOOP UNLESS MAX LENGTH
2c
2051
MAXLEN

        JLT     RLOOP             HAS BEEN REACHED
38
2054
RLOOP

EXIT    STX     LENGTH          SAVE RECORD LENGTH
10
2057
LENGTH

        RSUB                    RETURN TO CALLER
0
2057


INPUT   BYTE    X'F1'           CODE FOR INPUT DEVICE
0
2058
X'F1'

MAXLEN  WORD    4096
0
205b
4096

.
.       SUBROUTINE TO WRITE RECORD FROM BUFFER
.
WRREC   LDX    ZERO             CLEAR LOOP COUNTER
4
205e
ZERO

WLOOP   TD     OUTPUT           TEST OUTPUT DEVICE
e0
2061
OUTPUT

        JEQ    WLOOP            LOOP UNTIL READY
30
2064
WLOOP

        LDCH   BUFFER         GET CHARCTER FROM BUFFER
50
2067
BUFFER

        WD     OUTPUT           WRITE CHARACTER
dc
206a
OUTPUT

        TIX    LENGTH           LOOP UNTIL ALL CHARACTERS
2c
206d
LENGTH

        JLT    WLOOP              HAVE BEEN WRITTEN
38
2070
WLOOP

        RSUB                    RETURN TO CALLER
0
2070


OUTPUT  BYTE   X'05'            CODE FOR OUTPUT DEVICE
0
2071
X'05'

        END    FIRST
FIRST 1000
CLOOP 1003
ENDFIL 1015
EOF 1027
THREE 102a
ZERO 102d
RETADR 1030
LENGTH 1033
BUFFER 1036
RDREC 2036
RLOOP 203c
EXIT 2054
INPUT 2057
MAXLEN 2058
WRREC 205b
WLOOP 205e
OUTPUT 2070
