COPY    START   1000            COPY FILE FROM INPUT TO OUTPUT

1000 
1000 

FIRST   STL     RETADR          SAVE RETURN ADDRESS
1003 
RETADR 

CLOOP   JSUB    RDREC           READ INPUT RECORD
1006 
RDREC 

        LDA     LENGTH          TEST FOR EOF (LENGTH = 0)
1009 
LENGTH 

        COMP    ZERO
100c 
ZERO 

        JEQ     ENDFIL          EXIT IF EOF FOUND
100f 
ENDFIL 

        JSUB    WRREC           WRITE OUTPUT RECORD
1012 
WRREC 

        J       CLOOP           LOOP
1015 
CLOOP 

ENDFIL  LDA     EOF             INSERT END OF FILE MARKER
1018 
EOF 

        STA     BUFFER
101b 
BUFFER 

        LDA     THREE           SET LENGTH = 3
101e 
THREE 

        STA     LENGTH
1021 
LENGTH 

        JSUB    WRREC           WRITE EOF
1024 
WRREC 

        LDL     RETADR          GET RETURN ADDRESS
1027 
RETADR 

        RSUB                    RETURN TO CALLER
1027 
 

EOF     BYTE    C'EOF'
102a 
C'EOF' 

THREE   WORD    3
102d 
3 

ZERO    WORD    0
1030 
0 

RETADR  RESW    1
1033 
1 

LENGTH  RESW    1               LENGTH OF RECORD
1036 
1 

BUFFER  RESB    4096            4096-BYTE BUFFER AREA
2036 
4096 

.
2036 
 

.       SUBROUTINE TO READ RECORD INTO BUFFER
2036 
NE TO READ RECORD INTO BUFFER 

.
2036 
 

RDREC   LDX     ZERO            CLEAR LOOP COUNTER
2039 
ZERO 

        LDA     ZERO            CLEAR A TO ZERO
203c 
ZERO 

RLOOP   TD      INPUT           TEST INPUT DEVICE
203f 
INPUT 

        JEQ     RLOOP           LOOP UNTIL READY
2042 
RLOOP 

        RD      INPUT           READ CHARACTER INTO REGISTAR A
2045 
INPUT 

        COMP    ZERO            TEST FOR END OF RECORD (X'00')
2048 
ZERO 

        JEQ     EXIT            EXIT LOOP IF EOF
204b 
EXIT 

        STCH    BUFFER,X        STORE CHARCTER IN BUFFER
204e 
BUFFER,X 

        TIX     MAXLEN          LOOP UNLESS MAX LENGTH
2051 
MAXLEN 

        JLT     RLOOP             HAS BEEN REACHED
2054 
RLOOP 

EXIT    STX     LENGTH          SAVE RECORD LENGTH
2057 
LENGTH 

        RSUB                    RETURN TO CALLER
2057 
 

INPUT   BYTE    X'F1'           CODE FOR INPUT DEVICE
2058 
X'F1' 

MAXLEN  WORD    4096
205b 
4096 

.
205b 
 

.       SUBROUTINE TO WRITE RECORD FROM BUFFER
205b 
NE TO WRITE RECORD FROM BUFFER 

.
205b 
 

WRREC   LDX    ZERO             CLEAR LOOP COUNTER
205e 
ZERO 

WLOOP   TD     OUTPUT           TEST OUTPUT DEVICE
2061 
OUTPUT 

        JEQ    WLOOP            LOOP UNTIL READY
2064 
WLOOP 

        LDCH   BUFFER,X         GET CHARCTER FROM BUFFER
2067 
BUFFER,X 

        WD     OUTPUT           WRITE CHARACTER
206a 
OUTPUT 

        TIX    LENGTH           LOOP UNTIL ALL CHARACTERS
206d 
LENGTH 

        JLT    WLOOP              HAVE BEEN WRITTEN
2070 
WLOOP 

        RSUB                    RETURN TO CALLER
2070 
 

OUTPUT  BYTE   X'05'            CODE FOR OUTPUT DEVICE
2071 
X'05' 

        END    FIRST
FIRST 1000
CLOOP 1003
ENDFIL 1015
EOF 1027
THREE 102a
ZERO 102d
RETADR 1030
LENGTH 1033
BUFFER 1036
RDREC 2036
RLOOP 203c
EXIT 2054
INPUT 2057
MAXLEN 2058
WRREC 205b
WLOOP 205e
OUTPUT 2070
