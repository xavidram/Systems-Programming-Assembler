COPY    START   1000            COPY FILE FROM INPUT TO OUTPUT

1000 
1000 

FIRST   STL     RETADR          SAVE RETURN ADDRESS

RETADR 

CLOOP   JSUB    RDREC           READ INPUT RECORD

RDREC 

        LDA     LENGTH          TEST FOR EOF (LENGTH = 0)

LENGTH 

        COMP    ZERO

ZERO 

        JEQ     ENDFIL          EXIT IF EOF FOUND

ENDFIL 

        JSUB    WRREC           WRITE OUTPUT RECORD

WRREC 

        J       CLOOP           LOOP

CLOOP 

ENDFIL  LDA     EOF             INSERT END OF FILE MARKER

EOF 

        STA     BUFFER

BUFFER 

        LDA     THREE           SET LENGTH = 3

THREE 

        STA     LENGTH

LENGTH 

        JSUB    WRREC           WRITE EOF

WRREC 

        LDL     RETADR          GET RETURN ADDRESS

RETADR 

        RSUB                    RETURN TO CALLER

 

EOF     BYTE    C'EOF'

C'EOF' 

THREE   WORD    3

3 

ZERO    WORD    0

0 

RETADR  RESW    1

1 

LENGTH  RESW    1               LENGTH OF RECORD

1 

BUFFER  RESB    4096            4096-BYTE BUFFER AREA

4096 

.
.       SUBROUTINE TO READ RECORD INTO BUFFER
.
RDREC   LDX     ZERO            CLEAR LOOP COUNTER

ZERO 

        LDA     ZERO            CLEAR A TO ZERO

ZERO 

RLOOP   TD      INPUT           TEST INPUT DEVICE

INPUT 

        JEQ     RLOOP           LOOP UNTIL READY

RLOOP 

        RD      INPUT           READ CHARACTER INTO REGISTAR A

INPUT 

        COMP    ZERO            TEST FOR END OF RECORD (X'00')

ZERO 

        JEQ     EXIT            EXIT LOOP IF EOF

EXIT 

        STCH    BUFFER,X        STORE CHARCTER IN BUFFER

BUFFER,X 

        TIX     MAXLEN          LOOP UNLESS MAX LENGTH

MAXLEN 

        JLT     RLOOP             HAS BEEN REACHED

RLOOP 

EXIT    STX     LENGTH          SAVE RECORD LENGTH

LENGTH 

        RSUB                    RETURN TO CALLER

 

INPUT   BYTE    X'F1'           CODE FOR INPUT DEVICE

X'F1' 

MAXLEN  WORD    4096

4096 

.
.       SUBROUTINE TO WRITE RECORD FROM BUFFER
.
WRREC   LDX    ZERO             CLEAR LOOP COUNTER

ZERO 

WLOOP   TD     OUTPUT           TEST OUTPUT DEVICE

OUTPUT 

        JEQ    WLOOP            LOOP UNTIL READY

WLOOP 

        LDCH   BUFFER,X         GET CHARCTER FROM BUFFER

BUFFER,X 

        WD     OUTPUT           WRITE CHARACTER

OUTPUT 

        TIX    LENGTH           LOOP UNTIL ALL CHARACTERS

LENGTH 

        JLT    WLOOP              HAVE BEEN WRITTEN

WLOOP 

        RSUB                    RETURN TO CALLER

 

OUTPUT  BYTE   X'05'            CODE FOR OUTPUT DEVICE

X'05' 

        END    FIRST
FIRST 1000
CLOOP 1003
ENDFIL 1015
EOF 1027
THREE 102a
ZERO 102d
RETADR 1030
LENGTH 1033
BUFFER 1036
RDREC 2036
RLOOP 203c
EXIT 2054
INPUT 2057
MAXLEN 2058
WRREC 205b
WLOOP 205e
OUTPUT 2070
